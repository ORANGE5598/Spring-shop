<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extra/spring-security">
<style>
#background {
	background-color: #f48aaa;
}
</style>

<body>
	<div id="wrapper">
		<header class="bg-gradient-dark">

			<div class="page-header min-vh-50" id="background">
				<span class="mask bg-gradient-dark opacity-6"></span>
				<div class="container">
					<div class="row justify-content-center">
						<div class="col-lg-8 text-center mx-auto my-auto">
							<h1 class="text-white">마이 페이지</h1>
							<span sec:authorize="isAuthenticated()"></span>
						</div>
					</div>
				</div>
			</div>
		</header>
		<div class="card card-body shadow-xl mx-3 mx-md-4 mt-n6">
			<section class="py-7">
				<div class="container">
					<div class="row align-items-center">
						<div class="col-lg-6">
							<div class="row justify-content-start">
								<form style="margin: auto" th:object="${member}">
								
								
									<input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
									<div class="input-group input-group-static mb-4">
	                <input type="hidden" th:field="*{username}" th:value="*{username}" class="form-control"
                    th:id="username" readonly>
                </div>
                
                <h5>이름</h5>
                <div class="input-group input-group-static mb-4">
                <input type="text" th:field="*{name}" th:value="*{name}" class="form-control"
                th:id="name">
                </div>


									<h5>이메일</h5>
									<div class="input-group input-group-static mb-4">
										<input type="text" th:field="*{email}" th:value="*{email}"
											class="form-control" th:id="email">
									</div>

									<h5>도로명주소</h5>
									<div class="input-group input-group-static mb-4">
										<input type="text" th:field="*{address1}"
											th:value="*{address1}" class="form-control" th:id="address1">
									</div>

									<h5>상세주소</h5>
									<div class="input-group input-group-static mb-4">
										<input type="text" th:field="*{address2}"
											th:value="*{address2}" class="form-control" th:id="address2">
									</div>

									<h5>휴대폰</h5>
									<div class="input-group input-group-static mb-4">
										<input type="text" th:field="*{phone}" th:value="*{phone}"
											class="form-control" th:id="phone">
									</div>

									<h3>비밀번호 변경</h3>
									<div class="input-group input-group-static mb-4">
										<label style="font-weight: bold" th:for="password">변경할
											비밀번호 입력</label> <input type="password" th:id="password"
											th:name="password" placeholder="변경할 비밀번호를 입력하세요."
											class="form-control">
									</div>
								</form>
								<button id="memberUpdate" class="btn bg-gradient-primary" value="회원 정보 수정"
                                    th:onclick="memberUpdate()">회원 정보 수정</button>

							</div>
						</div>
						<div class="col-lg-4 ms-auto mt-lg-0 mt-4">
							<div class="card">
								<div
									class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
									<div class="card-body text-center">
										<h3 class="font-weight-normal">
											<a>내 정보 수정</a>
										</h3>
										<hr />
									</div>

								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>
	<th:block th:replace="/layout/fragment/footer :: footerFragment"></th:block>
</body>
<th:block th:replace="/layout/fragment/script :: scriptFragment"></th:block>
<script>
    function memberUpdate(){
        const data = {
        		username: $('#username').val(), 
				name: $('#name').val(), 
				email: $('#email').val(), 
				address1: $('#address1').val(), 
				address2: $('#address2').val(), 
				phone: $('#phone').val(),
				password: $('#password').val()
        };


        const confirmCheck = confirm("수정하시겠습니까?");

        if(confirmCheck == true){
            $.ajax({
                type: 'PUT',
                url: '/confirm',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(data)
            }).done(function(result){
                if(result){
                    alert("회원 수정이 완료되었습니다.");
                    window.location.href="/mypage";
                } else{
                    alert("이미 사용 중인 이메일입니다. 다시 입력해주세요.");
                    $('#email').focus();
                }
            }).fail(function(error){
                alert(JSON.stringify(error));
                console.log(JSON.stringify(error));
            });
        }
    }
</script>