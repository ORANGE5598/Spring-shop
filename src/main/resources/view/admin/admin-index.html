<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/defaultLayout}"
      xmlns:layout="http://www.w3.org/1999/xhtml">

<th:block layout:fragment="content">
    <main class="content">
        <div id="userMypage">
            <section class="mypage-sc">
                <h1 class="mypage-title">mypage</h1>

                <div class="user-info">

                    <div class="user-img">
                        <img src="../img/icons/favicon.png">
                    </div>

                    <div class="mypage-top">
                        <div class="user-nickname">
                            <strong>[[${member.name}]]님 안녕하세요</strong>
                        </div>
                    </div>


                    <div class="user-bankbook">


                        <a href="/admin/list">
                            <svg width="38" height="38"
                                 viewBox="0 0 38 38" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path
                                        d="M5.06665 28.8778H4.56665V29.3778H5.06665V28.8778ZM32.9333 28.8778V29.3778H33.4333V28.8778H32.9333ZM32.9333 21.3444H33.4333V20.8444H32.9333V21.3444ZM32.9333 16.3222V16.8222H33.4333V16.3222H32.9333ZM32.9333 8.78888L33.4333 8.78888V8.28888H32.9333V8.78888ZM5.06665 8.78888V8.28888H4.56665V8.78888H5.06665ZM5.06665 16.3222H4.56665V16.8222H5.06665V16.3222ZM5.06665 21.3444V20.8444H4.56665V21.3444H5.06665ZM25.3333 28.3778H5.06665V29.3778H25.3333V28.3778ZM32.9333 28.3778H25.3333V29.3778H32.9333V28.3778ZM32.4333 21.3444L32.4333 28.8778H33.4333L33.4333 21.3444H32.4333ZM32.9333 20.8444C31.8062 20.8444 30.9 19.9399 30.9 18.8333H29.9C29.9 20.5005 31.2622 21.8444 32.9333 21.8444V20.8444ZM30.9 18.8333C30.9 17.7268 31.8062 16.8222 32.9333 16.8222V15.8222C31.2622 15.8222 29.9 17.1662 29.9 18.8333H30.9ZM32.4333 8.78888L32.4333 16.3222H33.4333L33.4333 8.78888L32.4333 8.78888ZM25.3333 9.28888H32.9333V8.28888H25.3333V9.28888ZM5.06665 9.28888H25.3333V8.28888H5.06665V9.28888ZM5.56665 16.3222V8.78888H4.56665V16.3222H5.56665ZM8.09998 18.8333C8.09998 17.1662 6.73775 15.8222 5.06665 15.8222V16.8222C6.19379 16.8222 7.09998 17.7268 7.09998 18.8333H8.09998ZM5.06665 21.8444C6.73775 21.8444 8.09998 20.5005 8.09998 18.8333H7.09998C7.09998 19.9399 6.19379 20.8444 5.06665 20.8444V21.8444ZM5.56665 28.8778V21.3444H4.56665V28.8778H5.56665ZM24.8333 8.78888V11.3H25.8333V8.78888H24.8333ZM25.8333 28.8778V26.3667H24.8333V28.8778H25.8333Z"
                                        fill="white"></path>
                                <path
                                        d="M19.6333 15.0667H17.7C15.6197 15.0667 13.9333 16.753 13.9333 18.8333V18.8333C13.9333 20.9136 15.6197 22.6 17.7 22.6H19.6333"
                                        stroke="white"></path>
                                <path
                                        d="M25.3333 13.8111L25.3333 17.5778" stroke="white"></path>
                                <path
                                        d="M25.3333 20.0889L25.3333 23.8555" stroke="white"></path>
                            </svg>
                            <em> 상품관리 <i class="fa fa-angle-right"></i>
                            </em> <strong style="font-size: 25px;"> 등록/목록</strong>
                        </a> <a href="/admin/userlist">
                        <svg width="38" height="38"
                             viewBox="0 0 38 38" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <path
                                    d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="white"></path>
                            <circle cx="9" cy="7" r="4"
                                    stroke="white"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"
                                  stroke="white"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"
                                  stroke="white"></path>
                        </svg>
                        <em> 회원관리 <i class="fa fa-angle-right"></i>
                        </em> <strong style="font-size: 25px;"> 목록</strong>
                    </a> <a href="/admin/noticeWrite">
                        <svg width="38" height="38"
                             viewBox="0 0 38 38" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <path
                                    d="M31.6666 31.3889H17.7333M6.33325 24.4617L24.6781 6.27777L31.6666 13.205L13.3218 31.3889H6.33325V24.4617Z"
                                    stroke="white"></path>
                        </svg>
                        <em> 게시판관리 <i
                                class="fa fa-angle-right"></i>
                        </em> <strong style="font-size: 25px;"> 공지사항 작성</strong>
                    </a>
                    </div>
                </div>
            </section>
        </div>

        <section class="mypage-cont mypage-order_list">
            <div class="section-title">
                <h1 class="tit">주문 목록</h1>
            </div>

            <form name="admin-search" id="admin-search" method="get" action="#">
                <div class="order-filter">
                    <div class="flex-c-m">
                        <div class="d-grid gap-2 d-md-block m-r-8">
                            <button type="button" class="btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="전체">전체 ([[${listCount}]])
                            </button>
                            <button type="button" class="btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="결제완료">결제완료 ([[${count0}]])
                            </button>
                            <button type="button" class="btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="배송중">배송중 ([[${count1}]])
                            </button>
                            <button type="button" class="btn btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="배송완료">배송완료 ([[${count2}]])
                            </button>
                            <button type="button" class="btn btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="반품대기">반품대기 ([[${count3}]])
                            </button>
                            <button type="button" class="btn btn btn-dark btn__tab"
                                    onClick="statusClicked(event)" data-status="반품완료">반품완료 ([[${count4}]])
                            </button>
                        </div>

                    </div>

                    <div class="order-filter-search m-l-20">
                        <div class="order-filter-search__input-wrap">
                            <input type="text" class="order-filter-search__input "
                                   name="keyword" value="" placeholder="주문자/주문번호로 검색"
                                   onchange="activateSearchButton();">
                        </div>
                    </div>
                    <button type="button" class="user_state-confirm"
                            onclick="search();">조회하기
                    </button>
                </div>
            </form>

            <div class="m-lr-auto m-b-50 table-responsive">
                <table class="table table-hover table-col">
                    <thead>
                    <tr>
                        <th class="column-1"></th>
                        <th class="column-2">상품정보</th>
                        <th class="column-3">주문일자</th>
                        <th class="column-4">주문번호</th>
                        <th class="column-5">주문금액(수량)</th>
                        <th colspan="2" class="column-6">주문 상태</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr class="table_row" th:each="list : ${allList}"
                        th:id="${list.oNumber}">
                        <!--상품사진-->
                        <td class="column-1">
                            <div class="img-block">
                                <a href="#"> <img th:src="${list.img}" alt="방랑자 가방">
                                </a>
                            </div>
                        </td>

                        <!--상품정보-->
                        <td class="column-2">
                            <div class="product_row">
                                <ul class="info">
                                    <li class="mName"><a href="#">[[${list.mName}]]</a></li>
                                    <li class="oName">[[${list.oName}]]</li>
                                    <li class="oSize">사이즈 : [[${list.oSize}]]</li>
                                </ul>
                            </div>
                        </td>

                        <!--주문일자-->
                        <td class="column-3">[[${list.createdDate}]]</td>

                        <!--주문번호--->
                        <td class="column-4 oNumber"><a href="#">[[${list.oNumber}]]</a>
                        </td>

                        <!--가격,갯수-->
                        <td class="column-5">[[${list.oTotalPrice}]]원 <br> <span
                                class="txt-default"> [[${list.oCount}]]개 </span>
                        </td>

                        <!--배송상태-->
                        <td class="column-6"><span id="status"
                                                   class="badge badge-pill badge-success w-full fs-14 dStatus">[[${list.deliveryStatus}]]</span>
                        </td>

                        <td class="txt-lighter column-6">

                            <form method="post" th:action="@{/admin/modifyDeliveryStatus}">
                                <select id="status-select" name="deliveryStatus" class="dStat">
                                    <option class="deliveryStatus" value="배송중">배송중</option>
                                    <option class="deliveryStatus" value="배송완료">배송완료</option>
                                    <option class="deliveryStatus" value="반품대기">반품대기</option>
                                    <option class="deliveryStatus" value="반품완료">반품완료</option>
                                </select> <input type="hidden" name="oNumber" th:value="${list.oNumber}">
                                <button type="submit" class="btn btn-outline-dark btn-sm">
                                    수정
                                </button>
                            </form>

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    <!--===============================================================================================-->
    <script>

        const spanElements = document.querySelectorAll('.dStatus');

        spanElements.forEach(function (spanElement) {
            const deliveryStatus = spanElement.textContent.trim();
            switch (deliveryStatus) {
                case '배송중':
                    spanElement.classList.remove('badge-success', 'badge-warning', 'badge-danger');
                    spanElement.classList.add('badge-primary');
                    break;
                case '배송완료':
                    spanElement.classList.add('badge-success');
                    break;
                case '반품대기':
                    spanElement.classList.add('badge-warning');
                    break;
                case '반품완료':
                    spanElement.classList.add('badge-danger');
                    break;
            }
        });

    </script>
    <!--==============================================================================================-->
    <script>

        const spanElement = document.getElementById('status');
        const selectElement = document.getElementById('status-select');

        selectElement.addEventListener('change', function () {
            const selectedValue = this.value;

            switch (selectedValue) {
                case '배송중':
                    spanElement.textContent = '배송중';
                    spanElement.classList.remove('badge-success', 'badge-warning', 'badge-danger');
                    spanElement.classList.add('badge-primary');
                    break;
                case '배송완료':
                    spanElement.textContent = '배송완료';
                    spanElement.classList.remove('badge-primary', 'badge-warning', 'badge-danger');
                    spanElement.classList.add('badge-success');
                    break;
                case '반품대기':
                    spanElement.textContent = '반품대기';
                    spanElement.classList.remove('badge-success', 'badge-primary', 'badge-danger');
                    spanElement.classList.add('badge-warning');
                    break;
                case '반품완료':
                    spanElement.textContent = '반품완료';
                    spanElement.classList.remove('badge-success', 'badge-warning', 'badge-primary');
                    spanElement.classList.add('badge-danger');
                    break;
            }
        });

        function showConfirm() {
            const selectedValue = selectElement.value;

            swal.fire({
                title: '상태 변경',
                text: `'${selectedValue}'로 상태를 변경하시겠습니까?`,
                icon: 'warning',
                buttons: ['취소', '변경'],
                dangerMode: true,
            }).then((confirmed) => {
                if (confirmed) {

                    //


                    //
                    spanElement.textContent = selectedValue;
                    selectElement.value = selectedValue;
                    switch (selectedValue) {
                        case '배송중':
                            spanElement.classList.remove('badge-success', 'badge-warning', 'badge-danger');
                            spanElement.classList.add('badge-primary');
                            break;
                        case '배송완료':
                            spanElement.classList.remove('badge-primary', 'badge-warning', 'badge-danger');
                            spanElement.classList.add('badge-success');
                            break;
                        case '반품대기':
                            spanElement.classList.remove('badge-success', 'badge-primary', 'badge-danger');
                            spanElement.classList.add('badge-warning');
                            break;
                        case '반품완료':
                            spanElement.classList.remove('badge-success', 'badge-warning', 'badge-primary');
                            spanElement.classList.add('badge-danger');
                            break;
                    }
                    swal('변경 완료', `상태가 '${selectedValue}'로 변경되었습니다.`, 'success');
                }
            });
        }


    </script>
    <!--==============================================================================================-->
    <script>
        function statusClicked(event) {
            event.preventDefault();

            const deliveryStatus = event.target.getAttribute('data-status');

            const rows = document.querySelectorAll('.table_row');

            rows.forEach((row) => {
                const rowDeliveryStatus = row.querySelector('.dStatus').textContent;

                if (rowDeliveryStatus !== deliveryStatus && deliveryStatus !== '전체') {
                    row.style.display = 'none'; // 숨김 처리
                } else {
                    row.style.display = 'table-row'; // 보이게 처리
                }
            });
        }
    </script>
    <!--==============================================================================================-->
    <script>
        function search() {
            const keyword = document.getElementsByName("keyword")[0].value;

            const rows = document.querySelectorAll(".table_row");

            rows.forEach((row) => {
                const oNumber = row.querySelector('.oNumber a').textContent.trim();
                const mName = row.querySelector('.mName a').textContent.trim();

                if (oNumber !== keyword && !mName.includes(keyword)) {
                    row.style.display = 'none'; // 숨김 처리
                } else {
                    row.style.display = 'table-row'; // 보이게 처리
                }
            });
        }
    </script>
    <!--==============================================================================================-->
</th:block>

</html>